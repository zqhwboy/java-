# 索引概述

* 什么是索引?

索引是在数据库表的字段上添加的,是为了提高查询效率存在的一种机制,一张表的一个字段可以添加一个索引,当然多个字段联合起来也可以添加索引.索引相当于一本书的目录,是为了缩小扫描范围而存在的一种机制.

* mysql在查询方面主要有两种方式:

​	1.第一种方式:全表(好比你where 后面是name=,他会扫描全表的name)扫描

2. 第二种方式:根据索引检索.

注意:在实际中,字典目录是排序的,按照 abcdef...排序,为什么排序呢?

因为只有排序了才会有区间查找这一说! (缩小扫描范围,其实就是扫描某个区间罢了!)

在mysql当中索引也是需要排序的,并且这个索引的排序和TreeSet数据结构相同,TreeSet底层是一个自平衡的二叉树!在mysql当中索引是一个B-Tree数据结构

遵循左小右大原则存放.采用中序遍历取数据.

* 索引的实现原理?

提醒1:在任何数据库当中主键都会自动添加索引对象,主键id字段上自动有索引,因为id是PK,另外在mysql当中,一个字段上如果有unique约束的话,也会自动创建索引对象.

提醒2:在任何数据库当中,任何一张表的任何一条记录在硬盘存储上都有一个硬盘的物理存储编号.

提醒3:在mysql当中,索引是一个单独的对象,不同的存储引擎以不同的形式存在,在MyISAM存储引擎中,索引存储在一个.MYI文件中,在InnnoDB存储引擎中索引存储在一个逻辑名称叫做tablespace的当中,在MEMORY存储引擎当中索引,被存储在内存中.不管索引存储在哪里,索引在msyql当中都是一个树的形式存在的(自平衡二叉树:B-Tree)

 **索引的实现原理:就是缩小扫描的范围,避免全表扫描**

大致的实现原理

![](D:\app\学习笔记\java基础重新来\java面试总结\java-\Mysql笔记\QQ截图20210601101401.png)

* 在mysql当中,主键上,以及unique字段上都会添加索引!!!

什么体套件下,我们考虑添加索引呢?

 条件1:数据量庞大

条件2:该字段经常出现在where后面,以条件的形式存在,也就是这个字段经常被扫描

条件3:该字段很少被DML操作.(因为DML之后,索引需要重新排序)

建议不要随意添加索引,因为索引也需要维护的,太多的话反而会降低性能.建议通过主键查,通过unique约束的字段进行查询,效率是比较高的.

* 索引怎么创建?怎么删除?语法是什么?

```sql
-- 添加索引
-- 给emp表的ename字段添加索引,起名:emp_ename_index
CREATE INDEX emp_ename_index ON emp(ename);
```

```sql
-- 删除索引
-- 将emp表上的emp_ename_index索引对象删除
DROP INDEX emp_ename_index ON emp;
```

* 在mysql当中,怎么查看一个SQL语句是否使用了索引进行检索?

```sql
EXPLAIN SELECT * FROM emp WHERE ename = 'king';
-- 看扫描的行数
-- type值为all 时候是没有用索引的
-- type值为ref的时候,是用了索引
```

# 索引失效的情况

* 索引有失效的时候,什么时候索引失效呢?

1. 失效的第一种情况

```sql
select * from emp where ename like '%T';
```

ename上即使添加了索引,也不会走索引,为什么?

​	原因是因为模糊匹配当中一"%"开头了! 尽量避免模糊查询的时候以"%"开始.这是一种优化的手段/策略

2. 失效的第二种情况:

   使用or的时候会失效,如果使用or那么要求or两边的条件字段都要有索引,如果其中一边有一个字段没有索引,那么另一个字段上的索引也会失效.所以这就是为什么不建议使用or的原因

   **可以使用union查**

   ```sql
   EXPLAIN SELECT * FROM emp WHERE ename='king' UNION 
   SELECT * FROM emp WHERE job='manager';
   
   ```

   3. 失效的第三种情况

      使用复合索引的时候,没有使用左侧的列查找,索引失效.

      

      什么是复合索引?

      两个字段,或者更多字段联合起来添加一个索引,叫做复合索引.

      ```sql
      create index emp_job_sal_index on emp (job,sal);
      explain select * from emp where job ='manager'; //用了索引
      explain select * from emp where sal =800;  //没用索引,没有用job
      ```

      

4. 失效的第四种情况

   ​	在where列当中索引列参加了运算,索引失效.

   ```sql
   explain select * from emp where sal+1=800; //是索引列参加运算,800+1这样不会失效
   ```

5. 失效的第五种情况

   在where当中索引列使用了函数

   ```sql
   explian select * from emp where lower(ename)='smith';
   ```

6. .....

# 索引的分类

* 索引是各种数据库进行优化的重要手段.优化的时候优先考虑的因素就是索引,索引在数据库当中分了很多类?

  **单一索引:**一个字段上添加索引

  **复合索引:**两个字段或者更多字段上添加索引

  **主键索引:**主键上添加索引

  **唯一性索引:**具有unique约束的字段上添加索引

  .....

  注意:唯一性比较弱的字段上索引的用处不大.



